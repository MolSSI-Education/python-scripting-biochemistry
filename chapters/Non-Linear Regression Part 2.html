
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Non-Linear Regression Part 2 &#8212; Python Data and Scripting for Biochemists</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Non-Linear Curve Fitting, Part 1" href="Nonlinear%20Curve%20Fitting%20Part%201.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/molssi_main_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Python Data and Scripting for Biochemists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="File_Parsing.html">
   File Parsing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Processing_Multiple_Files_and_Writing_Files.html">
   Processing Multiple Files and Writing Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Working_with_Pandas.html">
   Working with Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Linear_Regression.html">
   Linear Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Creating_Plots_in_Jupyter_Notebooks.html">
   Creating Plots in Jupyter Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Nonlinear%20Curve%20Fitting%20Part%201.html">
   Non-Linear Curve Fitting, Part 1
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Non-Linear Regression Part 2
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/chapters/Non-Linear Regression Part 2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/MolSSI-Education/python-scripting-biochemistry"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/MolSSI-Education/python-scripting-biochemistry/issues/new?title=Issue%20on%20page%20%2Fchapters/Non-Linear Regression Part 2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/MolSSI-Education/python-scripting-biochemistry/main?urlpath=tree/biochemist-python/chapters/Non-Linear Regression Part 2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-fitting">
   Data Fitting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-michaelis-menten-equation">
   The Michaelis-Menten equation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-functions">
   Creating Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-curve-fit">
   Using curve_fit
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-the-output-from-curve-fit">
   Extracting the output from curve_fit
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#review-of-f-string-printing">
   Review of f string printing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-data">
   Plotting the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#smoothing-the-plot">
   Smoothing the plot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#common-errors">
   Common errors
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="non-linear-regression-part-2">
<h1>Non-Linear Regression Part 2<a class="headerlink" href="#non-linear-regression-part-2" title="Permalink to this headline">¶</a></h1>
<div class="overview-this-is-a-title overview">
<p class="overview-title">Overview</p>
<p>Questions</p>
    <ul>
        <li> How can I perform statistically robust non-linear regression in a Jupyter notebook?</li>
    </ul>
<p>Objectives:</p>
    <ul>
        <li> Import data from a csv file
        <li> Create a function based on the equation to be fitted
        <li> Generate the best-fit curve with parameters and statistical descriptors
        <li> Create plots of the data
    </ul>
</div><div class="section" id="data-fitting">
<h2>Data Fitting<a class="headerlink" href="#data-fitting" title="Permalink to this headline">¶</a></h2>
<p>In an earlier module, you used the <code class="docutils literal notranslate"><span class="pre">linregress</span></code> function from the scipy.stats library to perform linear regression. This is sufficient for a least squares linear fit to your data. Python contains tools that also enable you to fit data to an equation that you have defined, with two or more paramaters. So it is ideal for nonlinear curve fitting to the Michaelis-Menten equation.</p>
<p>In this module, we will use some familiar tools: importing csv data into a pandas dataframe and plotting results using the matplotlib.pyplot library. We will also create a function based on the Michaelis-Menten equation. The exciting part is to learn to fit the data to the function using <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> from scipy.optimize.</p>
<p>Here are the steps in our process:</p>
<ol class="simple">
<li><p>Import the libraries and functions that you need, including curve_fit from scipy.optimize.</p></li>
<li><p>Set up a pandas dataframe from the MM_data.csv file you saved from the previous module.</p></li>
<li><p>Create your independent and dependent variables for curve fitting.</p></li>
<li><p>Create a function for the equation you want to fit. The function should accept as inputs the independent variable(s) and all the parameters to be fit.</p></li>
<li><p>Use the function curve_fit from the scipy.optimize library to fit your data.</p></li>
<li><p>Extract the fit parameters from the output of curve_fit.</p></li>
<li><p>Use your function to calculate y values using your fit model to see how well your model fits the data.</p></li>
<li><p>Graph your original data and the fit equation.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the libraries and functions that you need, including curve_fit from scipy.optimize.</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-michaelis-menten-equation">
<h2>The Michaelis-Menten equation<a class="headerlink" href="#the-michaelis-menten-equation" title="Permalink to this headline">¶</a></h2>
<p>The Michaelis-Menten equation (which is probably very familiar to you) describes kinetics for enzyme-catalyzed reactions. We will use the simplest version of the equation, based on initial reaction velocities with a single substrate.</p>
<p>In our equation,  there are two parameters, V<span class="math notranslate nohighlight">\(_{max}\)</span> (maximum velocity) and K<span class="math notranslate nohighlight">\(_m\)</span> (the Michaelis constant, which equals the substrate concentration at half maximal velocity), an independent variable, [S] = substrate concentration, and a dependent variable, V<span class="math notranslate nohighlight">\(_i\)</span>, the initial velocity.</p>
<div class="math notranslate nohighlight">
\[
V_i = \frac{V_{max} * [S]}{K_m + [S]}
\]</div>
<p>We will define the following variables for our equation:</p>
<ul class="simple">
<li><p>Vmax = the maximum velocity</p></li>
<li><p>Km = the Michaelis constant</p></li>
<li><p>SubConc = substrate concentration</p></li>
<li><p>Vi = initial velocity</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a pandas dataframe from the MM_data.csv file you saved from the previous module.</span>
<span class="c1"># create the filehandle</span>
<span class="n">datafile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;MM_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># import the data</span>
<span class="n">rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>

<span class="c1"># inspect the data to make sure you have substrate concentrations and initial velocities</span>
<span class="n">rates_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pNPP (mM)</th>
      <th>slopes</th>
      <th>initial velocities</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20.0</td>
      <td>0.514091</td>
      <td>34.272718</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10.0</td>
      <td>0.503140</td>
      <td>33.542678</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7.0</td>
      <td>0.470435</td>
      <td>31.362310</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>0.417021</td>
      <td>27.801416</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.0</td>
      <td>0.342445</td>
      <td>22.829652</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create your independent and dependent variables for curve fitting.</span>
<span class="n">ydata</span> <span class="o">=</span> <span class="n">rates_df</span><span class="p">[</span><span class="s1">&#39;initial velocities&#39;</span><span class="p">]</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">rates_df</span><span class="p">[</span><span class="s1">&#39;pNPP (mM)&#39;</span><span class="p">]</span>

<span class="c1"># Inspect your data to make sure it looks like a Michaelis-Menten plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f42212a8310&gt;]
</pre></div>
</div>
<img alt="../_images/Non-Linear Regression Part 2_6_1.png" src="../_images/Non-Linear Regression Part 2_6_1.png" />
</div>
</div>
</div>
<div class="section" id="creating-functions">
<h2>Creating Functions<a class="headerlink" href="#creating-functions" title="Permalink to this headline">¶</a></h2>
<p>To this point we have called a number of functions that are included with python libraries such pandas, numpy and matplotlib. Most code is organized into blocks of code which perform a particular task. These code blocks are called functions. A commercial software package likely has hundreds of thousands or millions of functions. Functions break up our code into smaller, more easily understandable statements, and also allow our code to be more modular, meaning we can take pieces and reuse them. In general, each function should perform only one computational task.</p>
<p>In Python, the following syntax is used to declare a function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">function_name</span><span class="p">(</span><span class="n">independent_variable</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="o">**</span> <span class="n">function</span> <span class="n">body</span> <span class="n">code</span> <span class="o">**</span>
    <span class="k">return</span> <span class="n">value_to_return</span>
</pre></div>
</div>
<p>Functions are defined using the <code class="docutils literal notranslate"><span class="pre">def</span></code> keyword, followed by the name of the function. The function may have independent variable(s) and parameters which are passed to it; these are in parenthesis following the function name. You then add a colon after the parentheses. This causes the function body code to indent in a Jupyter notebook coding cell . In certain cases, a function may have no parameters as well. Most (though not all) functions return some type of information. It is important to note here that defining a function does not execute it.</p>
<p>Now we will create a function for the Michaelis-Menten equation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a function for the equation you want to fit. The function should accept </span>
<span class="c1"># as inputs the independent variable(s) and all the parameters to be fit.</span>

<span class="k">def</span> <span class="nf">MM</span><span class="p">(</span><span class="n">SubConc</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">):</span>
    <span class="n">Vi</span> <span class="o">=</span> <span class="n">Vmax</span> <span class="o">*</span> <span class="n">SubConc</span><span class="o">/</span><span class="p">(</span><span class="n">Km</span> <span class="o">+</span> <span class="n">SubConc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Vi</span>

<span class="c1"># Test the function to see if it produces the expected output</span>

<span class="n">MM</span><span class="p">(</span><span class="n">rates_df</span><span class="p">[</span><span class="s1">&#39;pNPP (mM)&#39;</span><span class="p">],</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     95.238095
1     90.909091
2     87.500000
3     80.000000
4     66.666667
5     50.000000
6     41.176471
7     28.571429
8     16.666667
9      9.090909
10     4.761905
Name: pNPP (mM), dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ydata</span> <span class="o">=</span> <span class="n">rates_df</span><span class="p">(</span><span class="s1">&#39;initial velocities&#39;</span><span class="p">)</span> <span class="c1"># Common errors and how to read them</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mf">694e0</span><span class="n">dd4e545</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ydata</span> <span class="o">=</span> <span class="n">rates_df</span><span class="p">(</span><span class="s1">&#39;initial velocities&#39;</span><span class="p">)</span> <span class="c1"># Common errors and how to read them</span>

<span class="ne">TypeError</span>: &#39;DataFrame&#39; object is not callable
</pre></div>
</div>
</div>
</div>
<p>In the previous cell, we received an error message that resulted when we uses parentheses by mistake rather than square brackets in our attempt to assign a series from a dataframe to a variable. The error message is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;DataFrame&#39;</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">callable</span>
</pre></div>
</div>
<p>The term <code class="docutils literal notranslate"><span class="pre">callable</span></code> here refers to something that happens with a function.</p>
<p>Here are two very useful sources when you encounter errors: <a class="reference external" href="https://stackoverflow.com">Stack Overflow</a> and <a class="reference external" href="https://www.geeksforgeeks.org">GeeksforGeeks</a>. In fact, if you just paste your error in quotes (e.g., “TypeError: ‘DataFrame’ object is not callable”) into a search engine, you are likely to find hits from both sources.</p>
</div>
<div class="section" id="using-curve-fit">
<h2>Using curve_fit<a class="headerlink" href="#using-curve-fit" title="Permalink to this headline">¶</a></h2>
<p>The syntax for the curve_fit function from scipy.optimize is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
</pre></div>
</div>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Term</p></th>
<th class="text-align:left head"><p>Signficance</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>popt</p></td>
<td class="text-align:left"><p>optimized parameters</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>pcov</p></td>
<td class="text-align:left"><p>a 2D matrix of the covariance for the curve fit</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>curve_fit</p></td>
<td class="text-align:left"><p>the function from scipy.optimize</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>function</p></td>
<td class="text-align:left"><p>the function that curve_fit will use for fitting the data</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>xdata</p></td>
<td class="text-align:left"><p>a data array for the independent variable</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>ydata</p></td>
<td class="text-align:left"><p>a data array for the dependent variable</p></td>
</tr>
</tbody>
</table>
<p>You can learn much more about <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> in the online documentation for <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html">scipy.optimize.curve_fit</a>.</p>
<p>Let’s review the function, <code class="docutils literal notranslate"><span class="pre">MM</span></code>, that we defined above, to clearly distinguish the data, variables and parameters associated with <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> from those associated with <code class="docutils literal notranslate"><span class="pre">MM</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">MM</span><span class="p">(</span><span class="n">SubConc</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">):</span>
    <span class="n">Vi</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vmax</span> <span class="o">*</span> <span class="n">SubConc</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Km</span> <span class="o">+</span> <span class="n">SubConc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Vi</span>
</pre></div>
</div>
<p>You need to pass three pieces of data to <code class="docutils literal notranslate"><span class="pre">MM</span></code> to predict the initial velocity for an enzyme-catalyzed reaction: the substrate concentration, and values for <span class="math notranslate nohighlight">\(V_{max}\)</span> and <span class="math notranslate nohighlight">\(K_m\)</span>.</p>
<p>scipy.optimize.curve_fit() can then fit the data to the <code class="docutils literal notranslate"><span class="pre">MM</span></code> function you have defined. In an earlier module, there was a discussion of different ways to linearize data so that linear regression could be used, for example, taking logs of the molecular weights of protein standards to plot versus relative migration for an SDS-PAGE gel. With curve_fit, you can do a least squares regression fit for data that demonstrate nonlinear relationships.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the function curve_fit to fit your data.</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">MM</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="extracting-the-output-from-curve-fit">
<h2>Extracting the output from curve_fit<a class="headerlink" href="#extracting-the-output-from-curve-fit" title="Permalink to this headline">¶</a></h2>
<p>There are two outputs from curve_fit - popt and pcov. These are typical names that help to point to the contents of the variable, but you can choose any variable name you like.</p>
<ol class="simple">
<li><p>popt = a list of the optimized parameters. In our case, the two parameters are <span class="math notranslate nohighlight">\(V_{max}\)</span> and <span class="math notranslate nohighlight">\(K_m\)</span>. Remember that python starts counting at 0, so popt[0] = <span class="math notranslate nohighlight">\(V_{max}\)</span> and popt[1] = <span class="math notranslate nohighlight">\(K_m\)</span>.</p></li>
<li><p>pcov = an n-dimensional array of the covariance for the parameters, where n is the number of parameters. In our case, n = 2.</p></li>
</ol>
<p>So we can extract the fitted values for <span class="math notranslate nohighlight">\(V_{max}\)</span> and <span class="math notranslate nohighlight">\(K_m\)</span> just by setting variables equal to them. The covariance matrix can be used to extract standard errors or standard deviations for each of the parameters. In our case, we will calculate one standard deviation for each parameter. Note that we use two numpy functions (sqrt and diag) to calculate the standard deviation values from the 2D matrix for pcov.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the fit parameters from the output of curve_fit.</span>
<span class="n">Vmax</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Km</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Extract one standard deviation for each parameter</span>
<span class="n">stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span> <span class="c1"># returns one standard deviation for each parameter</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vmax for this reaction:&#39;</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="n">stdev</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Km for this reaction:&#39;</span><span class="p">,</span> <span class="n">Km</span><span class="p">,</span> <span class="s1">&#39;+/-&#39;</span><span class="p">,</span> <span class="n">stdev</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Vmax for this reaction: 36.657348357808445 +/- 0.6749595153861864
Km for this reaction: 1.192632242867685 +/- 0.08042268460381517
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="review-of-f-string-printing">
<h2>Review of f string printing<a class="headerlink" href="#review-of-f-string-printing" title="Permalink to this headline">¶</a></h2>
<p>It is unlikely that you will want to have your values printed out to more than 10 decimal places, which is the default when python prints floats. There are a number of ways to get around this that include truncation or rounding, but we are going to look at a very useful tool - <a class="reference external" href="https://realpython.com/python-f-strings/">f string printing</a>. Here is the syntax for an f string print statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a string you want to print that may contain </span><span class="si">{</span><span class="n">variables</span> <span class="ow">in</span> <span class="n">curly</span> <span class="n">brackets</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Variables of type float can also be assigned precision using this syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Vmax for this reaction: </span><span class="si">{</span><span class="n">Vmax</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Since Vmax is in curly brackets, the print statement will insert the value for the variable, Vmax, at that point in the print statement. Vmax is followed by <code class="docutils literal notranslate"><span class="pre">:.2f</span></code> which directs the print statement to print the value of Vmax to 2 decimal places. We will now use f string printing to control the precision on the values for our parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Vmax for this reaction: </span><span class="si">{</span><span class="n">Vmax</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">stdev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Vmax for this reaction: 36.66 +/- 0.67
</pre></div>
</div>
</div>
</div>
<div class="exercise-this-is-a-title exercise">
<p class="exercise-title">Exercise</p>
    <p> Print the value for K<sub>m</sub> +/- one standard deviation to three decimal places. </p>
<div class="dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Km for this reaction: </span><span class="si">{</span><span class="n">Km</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">stdev</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div></div>
<div class="section" id="plotting-the-data">
<h2>Plotting the data<a class="headerlink" href="#plotting-the-data" title="Permalink to this headline">¶</a></h2>
<p>At this point, you want to compare your plotted data with the curve based on the parameters from curve_fit. We’ll do this in two stages. First, we’ll use the <code class="docutils literal notranslate"><span class="pre">MM</span></code> function to calculate y values using your fit model to see how well your model fits the data.</p>
<p>We will use matplotlib.pyplot (please note the import statement at the top of this notebook) to create and annotate this plot. Our first plot will contain two sets of data:</p>
<ol class="simple">
<li><p>the actual data for initial velocity vs. substrate concentration from our pandas dataframe</p></li>
<li><p>the fitted data using the parameters generated by curve_fit.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_y</span> <span class="o">=</span> <span class="n">MM</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">)</span> <span class="c1"># calculates y values based on the curve_fit parameters</span>
<span class="c1"># using your fit model to see how well your model fits the data.</span>

<span class="c1"># Graph your original data and the fit equation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="c1"># the experimental data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">fit_y</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span> <span class="c1"># the fit equation</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fc619176450&gt;]
</pre></div>
</div>
<img alt="../_images/Non-Linear Regression Part 2_19_1.png" src="../_images/Non-Linear Regression Part 2_19_1.png" />
</div>
</div>
</div>
<div class="section" id="smoothing-the-plot">
<h2>Smoothing the plot<a class="headerlink" href="#smoothing-the-plot" title="Permalink to this headline">¶</a></h2>
<p>You probably noticed that the curve appears a bit disjointed, because it provides values only at the selected concentrations of the substrate. A fit curve based on 1000 x-values will be much smoother. To do this, we first use the numpy linspace function to create a new list of 1000 x-values ranging from the minimum xdata value (using the numpy min function) to the maximum xdata value (using the numpy max function). Then we generate a fit curve using the MM function. We then add the experimental data and the smoothed fit data to the plot. Note that the experimental data is plotted using <code class="docutils literal notranslate"><span class="pre">'bo'</span></code>. This tells matplotlib.pyplot to use blue (<code class="docutils literal notranslate"><span class="pre">b</span></code>) circles (<code class="docutils literal notranslate"><span class="pre">o</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To generate a smoother fitted curve</span>
<span class="n">smooth_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1"># x value range with 1000 points</span>
<span class="n">smooth_y</span> <span class="o">=</span> <span class="n">MM</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">)</span> <span class="c1"># y values for the 1000 points in smooth_x</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="c1"># plot of the experimental data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">smooth_y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;fit&#39;</span><span class="p">)</span> <span class="c1"># plot of the fit data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1"># legend added</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc678a338d0&gt;
</pre></div>
</div>
<img alt="../_images/Non-Linear Regression Part 2_21_1.png" src="../_images/Non-Linear Regression Part 2_21_1.png" />
</div>
</div>
<div class="exercise-this-is-a-title exercise">
<p class="exercise-title">Exercise</p>
    <p> Use what you learned in previous modules to label the x-axis and y-axis and to insert the values for $V_{max}$ and $K_m$ with their standard deviations in the white space on the graph. Change the symbol for the substrate concentrations to a red triangle. </p>
<div class="dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">smooth_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1"># x value range with 1000 points</span>
<span class="n">smooth_y</span> <span class="o">=</span> <span class="n">MM</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">)</span> <span class="c1"># y values for the 1000 points in smooth_x</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="c1"># plot of the experimental data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">smooth_y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;fit&#39;</span><span class="p">)</span> <span class="c1"># plot of the fit data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1"># legend added</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;[pNPP] (mM)&#39;</span><span class="p">)</span>  <span class="c1"># x-axis label</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;V$_i$ ($\mu$M/min)&#39;</span><span class="p">)</span>  <span class="c1"># y-axis label in LaTeX _{595} makes 595 the subscripts</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">F</span><span class="s1">&#39;Vmax = </span><span class="si">{</span><span class="n">Vmax</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">stdev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">F</span><span class="s1">&#39;Km = </span><span class="si">{</span><span class="n">Km</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">stdev</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete this cell when we are the module is complete.</span>

<span class="n">smooth_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1"># x value range with 1000 points</span>
<span class="n">smooth_y</span> <span class="o">=</span> <span class="n">MM</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">)</span> <span class="c1"># y values for the 1000 points in smooth_x</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="c1"># plot of the experimental data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">smooth_y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;fit&#39;</span><span class="p">)</span> <span class="c1"># plot of the fit data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1"># legend added</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;[pNPP] (mM)&#39;</span><span class="p">)</span>  <span class="c1"># x-axis label</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;V$_i$ ($\mu$M/min)&#39;</span><span class="p">)</span>  <span class="c1"># y-axis label in LaTeX _{595} makes 595 the subscripts</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">F</span><span class="s1">&#39;Vmax = </span><span class="si">{</span><span class="n">Vmax</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">stdev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">F</span><span class="s1">&#39;Km = </span><span class="si">{</span><span class="n">Km</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">stdev</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(7.5, 16, &#39;Km = 1.19 +/- 0.08&#39;)
</pre></div>
</div>
<img alt="../_images/Non-Linear Regression Part 2_23_1.png" src="../_images/Non-Linear Regression Part 2_23_1.png" />
</div>
</div>
<div class="exercise-this-is-a-title exercise">
<p class="exercise-title">Take Home Exercise</p>
    <p> If you want to dig deeper, you can complete the curve fitting analysis of the chymotrypsin data from the previous module. You may need to adjust some of the details to generate high quality output.</p>
<div class="dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the filehandle</span>
<span class="n">datafile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;chymo_MM_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># import the data</span>
<span class="n">c_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
<span class="n">c_rates_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    
<span class="c1"># Inspect the data</span>
<span class="n">c_ydata</span> <span class="o">=</span> <span class="n">c_rates_df</span><span class="p">[</span><span class="s1">&#39;Initial Velocities&#39;</span><span class="p">]</span>
<span class="n">c_xdata</span> <span class="o">=</span> <span class="n">c_rates_df</span><span class="p">[</span><span class="s1">&#39;pNPA (mM)&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_xdata</span><span class="p">,</span> <span class="n">c_ydata</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    
<span class="c1"># Non-linear regression with scipy.optimize.curve_fit    </span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">MM</span><span class="p">,</span> <span class="n">c_xdata</span><span class="p">,</span> <span class="n">c_ydata</span><span class="p">)</span>
<span class="n">Vmax</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Km</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span> <span class="c1"># returns one standard deviation for each parameter</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Vmax for this reaction: </span><span class="si">{</span><span class="n">Vmax</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Km for this reaction: </span><span class="si">{</span><span class="n">Km</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Plot the data</span>
<span class="n">smooth_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">c_xdata</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">c_xdata</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">smooth_y</span> <span class="o">=</span> <span class="n">MM</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_xdata</span><span class="p">,</span> <span class="n">c_ydata</span><span class="p">,</span> <span class="s1">&#39;r^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">smooth_y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The solution to the Take Home Exercise in the next four cells</span>
<span class="c1"># will be removed when we are ready to publish.</span>

<span class="c1"># create the filehandle</span>
<span class="n">datafile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;chymo_MM_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># import the data</span>
<span class="n">c_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
<span class="n">c_rates_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pNPA (mM)</th>
      <th>slopes</th>
      <th>Initial Velocities</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0000</td>
      <td>0.000557</td>
      <td>0.030412</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.5000</td>
      <td>0.000539</td>
      <td>0.029437</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.2500</td>
      <td>0.000500</td>
      <td>0.027293</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.1250</td>
      <td>0.000450</td>
      <td>0.024563</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0625</td>
      <td>0.000511</td>
      <td>0.027877</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The solution to the Take Home Exercise will be removed when we are ready to publish.</span>

<span class="c1"># Inspect the data</span>
<span class="n">c_ydata</span> <span class="o">=</span> <span class="n">c_rates_df</span><span class="p">[</span><span class="s1">&#39;Initial Velocities&#39;</span><span class="p">]</span>
<span class="n">c_xdata</span> <span class="o">=</span> <span class="n">c_rates_df</span><span class="p">[</span><span class="s1">&#39;pNPA (mM)&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_xdata</span><span class="p">,</span> <span class="n">c_ydata</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fc62967aa50&gt;]
</pre></div>
</div>
<img alt="../_images/Non-Linear Regression Part 2_26_1.png" src="../_images/Non-Linear Regression Part 2_26_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The solution to the Take Home Exercise will be removed when we are ready to publish.</span>

<span class="c1"># Non-linear regression with scipy.optimize.curve_fit</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">MM</span><span class="p">,</span> <span class="n">c_xdata</span><span class="p">,</span> <span class="n">c_ydata</span><span class="p">)</span>
<span class="n">Vmax</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Km</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span> <span class="c1"># returns one standard deviation for each parameter</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Vmax for this reaction: </span><span class="si">{</span><span class="n">Vmax</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Km for this reaction: </span><span class="si">{</span><span class="n">Km</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Vmax for this reaction: 0.0300 +/- 0.0012
Km for this reaction: 0.0097 +/- 0.0020
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The solution to the Take Home Exercise will be removed when we are ready to publish.</span>

<span class="c1"># Plot the data</span>
<span class="n">smooth_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">c_xdata</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">c_xdata</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">smooth_y</span> <span class="o">=</span> <span class="n">MM</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_xdata</span><span class="p">,</span> <span class="n">c_ydata</span><span class="p">,</span> <span class="s1">&#39;r^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_x</span><span class="p">,</span> <span class="n">smooth_y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc61952d0d0&gt;
</pre></div>
</div>
<img alt="../_images/Non-Linear Regression Part 2_28_1.png" src="../_images/Non-Linear Regression Part 2_28_1.png" />
</div>
</div>
</div>
<div class="section" id="common-errors">
<h2>Common errors<a class="headerlink" href="#common-errors" title="Permalink to this headline">¶</a></h2>
<p><strong>Should this material be added to the Introduction?</strong>
Python is very particular about the use of parentheses (), square brackets [], and braces or curly brackets {}.</p>
<p>Parentheses are used to pass arguments to functions. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Vi</span> <span class="o">=</span> <span class="n">MM</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">,</span> <span class="n">Km</span><span class="p">)</span>
</pre></div>
</div>
<p>Square brackets are used to create lists. In this example, the square brackets are used to call a series from the rates_df dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xdata</span> <span class="o">=</span> <span class="n">rates_df</span><span class="p">[</span><span class="s1">&#39;pNPP (mM)&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Curly brackets or braces are used to create dictionaries or sets.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Brady&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;Evans&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">}</span>
</pre></div>
</div>
<p>You can learn more about <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#mapping-types-dict">dictionaries in the python online manual</a>.</p>
<p>Here are two very useful sources when you encounter errors: <a class="reference external" href="https://stackoverflow.com">Stack Overflow</a> and <a class="reference external" href="https://www.geeksforgeeks.org">GeeksforGeeks</a>. In fact, if you just paste your error in quotes (e.g., “TypeError: ‘DataFrame’ object is not callable”) into a search engine, you are likely to find hits from both sources.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Nonlinear%20Curve%20Fitting%20Part%201.html" title="previous page">Non-Linear Curve Fitting, Part 1</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Molecular Sciences Software Institute<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-169902961-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>